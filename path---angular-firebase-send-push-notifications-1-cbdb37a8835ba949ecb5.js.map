{"version":3,"sources":["webpack:///path---angular-firebase-send-push-notifications-1-cbdb37a8835ba949ecb5.js","webpack:///./.cache/json/angular-firebase-send-push-notifications-1.json"],"names":["webpackJsonp","877","module","exports","data","post","id","html","fields","slug","prefix","frontmatter","title","subTitle","cover","childImageSharp","resize","src","author","footnote","site","siteMetadata","facebook","appId","pathContext"],"mappings":"AAAAA,cAAc,iBAERC,IACA,SAAUC,EAAQC,GCHxBD,EAAAC,SAAkBC,MAAQC,MAAQC,GAAA,qKAAAC,KAAA,218BAA2q+BC,QAA2bC,KAAA,+CAAAC,OAAA,cAA4EC,aAAgBC,MAAA,+CAAAC,SAAA,GAAAC,OAA8EC,iBAAmBC,QAAUC,IAAA,gFAAqFC,QAAWZ,GAAA,+GAAAC,KAAA,sGAAgOY,UAAab,GAAA,iHAAAC,KAAA;EAAwLa,MAASC,cAAgBC,UAAYC,MAAA,OAAcC,aAAgBf,KAAA","file":"path---angular-firebase-send-push-notifications-1-cbdb37a8835ba949ecb5.js","sourcesContent":["webpackJsonp([196905431834707],{\n\n/***/ 877:\n/***/ (function(module, exports) {\n\n\tmodule.exports = {\"data\":{\"post\":{\"id\":\"/Users/jslee/Development/lighthouse-dev.github.io/content/posts/2018-12-22--angular-firebase-send-push-notifications-1/index.md absPath of file >>> MarkdownRemark\",\"html\":\"<h1 id=\\\"はじめに\\\">はじめに</h1>\\n<p>こんにちは！</p>\\n<p><a href=\\\"https://qiita.com/advent-calendar/2017/fusic\\\">去年</a>に引き続き、今年も書きます。</p>\\n<p><a href=\\\"https://qiita.com/advent-calendar/2018/fusic\\\">Fusic Advent Calendar 2018</a> 19日目の記事です！</p>\\n<p>今回は、「Angular + Firebase + PWAでPush通知機能を実装」についてまとめてみました 👏</p>\\n<br>\\n<h1 id=\\\"やりたいこと\\\">やりたいこと</h1>\\n<p>PWAでPush機能実装したい！</p>\\n<p>※ PWAって何？的な説明は、以下を見てください</p>\\n<ul>\\n<li><a href=\\\"https://developers.google.com/web/fundamentals/codelabs/your-first-pwapp/?hl=ja\\\">https://developers.google.com/web/fundamentals/codelabs/your-first-pwapp/?hl=ja</a></li>\\n<li><a href=\\\"https://developers.google.com/web/progressive-web-apps/\\\">https://developers.google.com/web/progressive-web-apps/</a></li>\\n</ul>\\n<br>\\n<h1 id=\\\"開発環境\\\">開発環境</h1>\\n<ul>\\n<li>Angular 6</li>\\n<li>\\n<p>Firebase</p>\\n<ul>\\n<li>Realtime Database</li>\\n<li>Functions</li>\\n</ul>\\n</li>\\n</ul>\\n<br>\\n<h1 id=\\\"さっそく実装に入りましょう-🤩\\\">さっそく実装に入りましょう 🤩</h1>\\n<p>実装については、以下の流れで説明していきたいと思います！</p>\\n<ol>\\n<li>必要なモジュールなどをインストール</li>\\n<li>Push機能実装：アプリ側</li>\\n<li><a href=\\\"/angular-firebase-send-push-notifications-2\\\">Push機能実装：Firebase Functions側</a></li>\\n</ol>\\n<h2 id=\\\"必要なモジュールなどをインストール\\\">必要なモジュールなどをインストール</h2>\\n<p><strong>Firebase CLIをインストール</strong></p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-cmd\\\"><code class=\\\"language-cmd\\\">yarn global add firebase-tools@latest</code></pre>\\n      </div>\\n<p>※ Firebase CLIの詳細については、<a href=\\\"https://firebase.google.com/docs/cli/?hl=ja\\\">こちら</a>を見て下さい！</p>\\n<p><strong>Firebaseモジュールをインストール</strong></p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-cmd\\\"><code class=\\\"language-cmd\\\">yarn add firebase --save</code></pre>\\n      </div>\\n<p><a href=\\\"https://www.npmjs.com/package/firebase\\\">https://www.npmjs.com/package/firebase</a></p>\\n<br>\\n<h2 id=\\\"push機能実装：アプリ側\\\">Push機能実装：アプリ側</h2>\\n<h3 id=\\\"manifestjsonを修正\\\">manifest.jsonを修正</h3>\\n<p>ハードコード値 <code class=\\\"language-text\\\">gcm_sender_id</code> を指定するウェブアプリ マニフェストを追加する必要があります。</p>\\n<blockquote>\\n<p>「ブラウザ送信者 ID」と、Firebase プロジェクト設定に示されるプロジェクト固有の送信者 ID 値とを混同しないでください。\\nmanifest.json のブラウザ送信者 ID は固定値で、すべての FCM JavaScript クライアントで共通です。</p>\\n</blockquote>\\n<p> <code class=\\\"language-text\\\">gcm_sender_id</code>は、固定値ですので、変更しないでください！</p>\\n<div class=\\\"gatsby-code-title gatsby-remark-code-title\\\">src/manifest.json</div>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-json\\\"><code class=\\\"language-json\\\"><span class=\\\"token punctuation\\\">{</span>\\n  ... 省略 ...\\n  <span class=\\\"token property\\\">\\\"gcm_sender_id\\\"</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"103953800507\\\"</span> // ← gcm_sender_idを追加\\n  ... 省略 ...\\n<span class=\\\"token punctuation\\\">}</span>\\n</code></pre>\\n      </div>\\n<h3 id=\\\"メッセージサービスワーカーを作成\\\">メッセージサービスワーカーを作成</h3>\\n<p>Pushメッセージには、 <code class=\\\"language-text\\\">service worker</code> が必要になります。\\nまず、Firebaseで <code class=\\\"language-text\\\">messagingSenderId</code>をコピーしておきましょう。</p>\\n\\n  <a class=\\\"gatsby-resp-image-link\\\" href=\\\"/static/image-1-2942bf1f0d78ee14e610bf7e0b5d43b9-6eb54.png\\\" style=\\\"display: block\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">\\n  \\n  <span class=\\\"gatsby-resp-image-wrapper\\\" style=\\\"position: relative; display: block; margin-left: 0 !important; max-width: 800px; margin-left: auto; margin-right: auto;\\\">\\n    <span class=\\\"gatsby-resp-image-background-image\\\" style=\\\"padding-bottom: 74.63330457290768%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsSAAALEgHS3X78AAACo0lEQVQ4y5WTy24SURjHeQJ9AVcmWvsYLurGbWtStY0bbQXKDMMwUBtsNKm00tobt6YwMDPMDWa4VgreEo3v9fc7B0qLrQsXv3zn+j/f7QRuPRZwmwjMhUc8+k/m/mLxhYynK0ncWxAw+0TAA8ZChDMzH7kcE7Nje3/+khm+JkwIrIkSgkIMkajMEaQ4xJiCKCHFk5yonCCUaWIjK9J5fm98PxAUZITEEa/CIra2MzAtC5puoFRWUVZVGDUTbr0Ox53G830cZfPkBHt8nR5IMsEY95ALhkRkPh3g7KyHVqsFv9lEs9VEu91Gp9PhtDvjcbeLwWCA01KZIkpAVt4gRqIBJnQhuEIeftghD80GLMOEZRGOzanZ1sSatk1ROPA8D9lcnsL/hyALOZ3Zg1rRcFIoQjcMaDUD5ZoG3apBNw3YjoM6he+6LhqeT4KFmwXDZF+S4H5mF75eReWkCN+1SECHY5EgiVZqOs3tieB5x6eHR4LxxMZNglEcpnfwXdcwqFbw1dDwzTbw0zXh2SYVgrwjISbmkKdKsY7NvRxEVmUSZcW5nkMK2W54PE8WXTJsF4bboDUfVt2DS3s+VZflL621sHWQRzASnXTKpYfRUZX39g9x3v/Mq3zW68HpDqA1+9BbfXi9c3wZDjEcDtDt9/H71w+o1Sr1n8JzKLG2uerh6pqEjbfvkMsXeLKZPcgWkD7M4YjmBSrUx+Msty21jNpREYWdXcgkNFWUadEowjRm+YgRS2EJd5+tIijGCRl3lhaxHFqDmt7G8cNVlF6nkEqlqKnXr7fNxZh1PauaktxAhESXgwL3gFXzeTCMEJ3Zfb+F0/0TlCiHqcQ6JNqXr3oYGosGx96xb8R+gMi+Ff/fCY5Ec2aTtLapJLApjyIRx+f/AANl6wIhgsLkAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;\\\">\\n      <img class=\\\"gatsby-resp-image-image\\\" style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px transparent;\\\" alt=\\\"image 1\\\" title=\\\"\\\" src=\\\"/static/image-1-2942bf1f0d78ee14e610bf7e0b5d43b9-40b6f.png\\\" srcset=\\\"/static/image-1-2942bf1f0d78ee14e610bf7e0b5d43b9-9039c.png 200w,\\n/static/image-1-2942bf1f0d78ee14e610bf7e0b5d43b9-9db44.png 400w,\\n/static/image-1-2942bf1f0d78ee14e610bf7e0b5d43b9-40b6f.png 800w,\\n/static/image-1-2942bf1f0d78ee14e610bf7e0b5d43b9-6eb54.png 1159w\\\" sizes=\\\"(max-width: 800px) 100vw, 800px\\\">\\n    </span>\\n  </span>\\n  \\n  </a>\\n    \\n<p>次は、<code class=\\\"language-text\\\">src</code>ディレクトリの配下に <code class=\\\"language-text\\\">firebase-messaging-sw.js</code> を作成します。</p>\\n<p>そして、↑でコピーした<code class=\\\"language-text\\\">messagingSenderId</code> を、以下の <code class=\\\"language-text\\\">firebase.initializeApp()</code> に貼りつけます！</p>\\n<div class=\\\"gatsby-code-title gatsby-remark-code-title\\\">src/firebase-messaging-sw.js</div>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-typescript\\\"><code class=\\\"language-typescript\\\"><span class=\\\"token comment\\\">// Give the service worker access to Firebase Messaging.</span>\\n<span class=\\\"token comment\\\">// Note that you can only use Firebase Messaging here, other Firebase libraries</span>\\n<span class=\\\"token comment\\\">// are not available in the service worker.</span>\\n<span class=\\\"token function\\\">importScripts</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'https://www.gstatic.com/firebasejs/5.5.0/firebase-app.js'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token function\\\">importScripts</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'https://www.gstatic.com/firebasejs/5.5.0/firebase-messaging.js'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    \\n<span class=\\\"token comment\\\">// Initialize the Firebase app in the service worker by passing in the</span>\\n<span class=\\\"token comment\\\">// messagingSenderId.</span>\\nfirebase<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">initializeApp</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">{</span>\\n  messagingSenderId<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">''</span> <span class=\\\"token comment\\\">// ↑でコピーしたmessagingSenderIdを追加</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    \\n<span class=\\\"token comment\\\">// Retrieve an instance of Firebase Messaging so that it can handle background</span>\\n<span class=\\\"token comment\\\">// messages.</span>\\n<span class=\\\"token keyword\\\">const</span> messaging <span class=\\\"token operator\\\">=</span> firebase<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">messaging</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\nmessaging<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">setBackgroundMessageHandler</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">function</span><span class=\\\"token punctuation\\\">(</span>payload<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">const</span> notificationTitle <span class=\\\"token operator\\\">=</span> payload<span class=\\\"token punctuation\\\">.</span>notification<span class=\\\"token punctuation\\\">.</span>title<span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token keyword\\\">const</span> notificationOptions <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span>\\n    body<span class=\\\"token punctuation\\\">:</span> payload<span class=\\\"token punctuation\\\">.</span>notification<span class=\\\"token punctuation\\\">.</span>body<span class=\\\"token punctuation\\\">,</span>\\n    icon<span class=\\\"token punctuation\\\">:</span> payload<span class=\\\"token punctuation\\\">.</span>notification<span class=\\\"token punctuation\\\">.</span>icon\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token keyword\\\">return</span> self<span class=\\\"token punctuation\\\">.</span>registration<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">showNotification</span><span class=\\\"token punctuation\\\">(</span>notificationTitle<span class=\\\"token punctuation\\\">,</span> notificationOptions<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\nself<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">addEventListener</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'install'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token keyword\\\">function</span><span class=\\\"token punctuation\\\">(</span>event<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token builtin\\\">console</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">log</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'Service Worker installing.'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\nself<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">addEventListener</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'activate'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token keyword\\\">function</span><span class=\\\"token punctuation\\\">(</span>event<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token builtin\\\">console</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">log</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'Service Worker activating.'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre>\\n      </div>\\n<p>これで、ユーザーがアプリを閉じても、アプリが新しいメッセージを検知することができます！</p>\\n<h3 id=\\\"angularjsonを修正\\\">angular.jsonを修正</h3>\\n<p>angular.jsonに<code class=\\\"language-text\\\">manifest.json</code>, <code class=\\\"language-text\\\">firebase-messaging-sw.js</code> を追加</p>\\n<div class=\\\"gatsby-code-title gatsby-remark-code-title\\\">angular.json</div>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-json\\\"><code class=\\\"language-json\\\"><span class=\\\"token punctuation\\\">{</span>\\n  ... 省略 ...\\n  <span class=\\\"token property\\\">\\\"projects\\\"</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token property\\\">\\\"architect\\\"</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token property\\\">\\\"build\\\"</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token punctuation\\\">{</span>\\n        <span class=\\\"token property\\\">\\\"options\\\"</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token punctuation\\\">{</span>\\n          <span class=\\\"token property\\\">\\\"assets\\\"</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token punctuation\\\">[</span>\\n            <span class=\\\"token string\\\">\\\"src/favicon.ico\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n            <span class=\\\"token string\\\">\\\"src/assets\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n            <span class=\\\"token string\\\">\\\"src/manifest.json\\\"</span><span class=\\\"token punctuation\\\">,</span> // ←追加\\n            <span class=\\\"token string\\\">\\\"src/firebase-messaging-sw.js\\\"</span> // ←追加\\n          <span class=\\\"token punctuation\\\">]</span>\\n        <span class=\\\"token punctuation\\\">}</span>\\n      <span class=\\\"token punctuation\\\">}</span>\\n    <span class=\\\"token punctuation\\\">}</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n</code></pre>\\n      </div>\\n<h3 id=\\\"メッセージサービスを作成\\\">メッセージサービスを作成</h3>\\n<p>まずは、Firebaseの「鍵ペア」を生成する必要があります。</p>\\n<h4 id=\\\"firebaseで「鍵ペア」を生成\\\">Firebaseで「鍵ペア」を生成</h4>\\n<p>「プロジェクトの設定＞クラウドメッセージング」に入って、鍵ペアを生成してください。</p>\\n\\n  <a class=\\\"gatsby-resp-image-link\\\" href=\\\"/static/image-2-694ee39e36a729fdf3a2bde5a0a1977e-4dcde.png\\\" style=\\\"display: block\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">\\n  \\n  <span class=\\\"gatsby-resp-image-wrapper\\\" style=\\\"position: relative; display: block; margin-left: 0 !important; max-width: 800px; margin-left: auto; margin-right: auto;\\\">\\n    <span class=\\\"gatsby-resp-image-background-image\\\" style=\\\"padding-bottom: 78.64493996569468%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsSAAALEgHS3X78AAACOElEQVQ4y6WTy2oUQRSGWwTXgiufRHDvzncQ3JgYjBPxtowJiQYRFJlkQhgcTYaZ6a5rd1VfjKMufK/fc6ovdCYiiIuPv8/p7r9O1TkVXXt0imj9M6KHXxBtnOHKxul/Ed0czHH9icKNQYyra2S8flazxgs1rPV0lQc9ON4/0did5Ngbp3h5uMDmYYLHQ9JhjC16HnBMbB3Vujm8yNNRghfHCZ6N6veRMQpGS0IhtQaO4lQJZJTLU9Phrb4Q5/RtSTqeK7ydCBxNJTKjEc2FRsssUUiUhrYW2lgobSApZm3jFkkYY/BqLHH/Q4LnxwJT+j+KpUbLQijYNIX3HnmeB1VKQQgRlNFaB6M2XpY5fi0r/KgKJOTRGKrO0FAlKZk654JhlmUhZmX6i9WawxGZ88HjkmHYjqTzIEM2dfQj/+xanK/zK/BinSEbMfw8TyRmsehy/0pn2KmQdBYyNEM2Dairyxs80swF2pz/25YNHbqjEeERcKZWxR1u0RaCFmNW85e2zF16N4mxfRJj75PAzljgDc1YrOoxEaSCDQnZaAe9WzHUYQzuvY9xe2eOO/sL3Nqe4e5BDGlTmkOaO5rPsiyRM0WJgrpcFEwROv7HsXF0A869xVfX4FNYyvG2TJqFjn7PLb5luhulllBhv8Os3Ay+FVyRMvUN8bR6SVUUVFlJzXg9+4mD6RIFNYJzXCF/02uK7s2hpopsGHC+EbbZZlVVtNWKbpLHx8U5RguKqdqS8vyuoCNgj99yop6cK27sYQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;\\\">\\n      <img class=\\\"gatsby-resp-image-image\\\" style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px transparent;\\\" alt=\\\"image 2\\\" title=\\\"\\\" src=\\\"/static/image-2-694ee39e36a729fdf3a2bde5a0a1977e-40b6f.png\\\" srcset=\\\"/static/image-2-694ee39e36a729fdf3a2bde5a0a1977e-9039c.png 200w,\\n/static/image-2-694ee39e36a729fdf3a2bde5a0a1977e-9db44.png 400w,\\n/static/image-2-694ee39e36a729fdf3a2bde5a0a1977e-40b6f.png 800w,\\n/static/image-2-694ee39e36a729fdf3a2bde5a0a1977e-4dcde.png 1166w\\\" sizes=\\\"(max-width: 800px) 100vw, 800px\\\">\\n    </span>\\n  </span>\\n  \\n  </a>\\n    \\n<p>生成した鍵ペアをコピーしておいてください⭐️</p>\\n<h4 id=\\\"サービスを作成\\\">サービスを作成</h4>\\n<p>メッセージサービスは、Push通知メッセージを受け取るユーザーの許可を得る役割をします。</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-cmd\\\"><code class=\\\"language-cmd\\\">ng g service messaging</code></pre>\\n      </div>\\n<p>ざっくり以下のような構成になります！</p>\\n<h5 id=\\\"getpermission\\\"><code class=\\\"language-text\\\">getPermission()</code></h5>\\n<ul>\\n<li>ユーザーからPush通知を行う許可を取得</li>\\n</ul>\\n<h5 id=\\\"updatetoken\\\"><code class=\\\"language-text\\\">updateToken()</code></h5>\\n<ul>\\n<li>FirebaseにFCMトークンを保存</li>\\n<li>ユーザーにPush通知を送る度にこのトークンを参照するので、Firebaseに保存する</li>\\n</ul>\\n<h5 id=\\\"receivemessage\\\"><code class=\\\"language-text\\\">receiveMessage()</code></h5>\\n<ul>\\n<li>メッセージを受信</li>\\n</ul>\\n<div class=\\\"gatsby-code-title gatsby-remark-code-title\\\">src/app/service/messaging.service.ts</div>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-typescript\\\"><code class=\\\"language-typescript\\\"><span class=\\\"token keyword\\\">import</span> <span class=\\\"token punctuation\\\">{</span> Injectable <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword\\\">from</span> <span class=\\\"token string\\\">'@angular/core'</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">import</span> <span class=\\\"token punctuation\\\">{</span> AngularFireDatabase <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword\\\">from</span> <span class=\\\"token string\\\">'angularfire2/database'</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">import</span> <span class=\\\"token punctuation\\\">{</span> AngularFireAuth <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword\\\">from</span> <span class=\\\"token string\\\">'angularfire2/auth'</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">import</span> <span class=\\\"token punctuation\\\">{</span> BehaviorSubject <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword\\\">from</span> <span class=\\\"token string\\\">'rxjs'</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">import</span> <span class=\\\"token operator\\\">*</span> <span class=\\\"token keyword\\\">as</span> firebase <span class=\\\"token keyword\\\">from</span> <span class=\\\"token string\\\">'firebase'</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">import</span> <span class=\\\"token string\\\">'firebase/messaging'</span><span class=\\\"token punctuation\\\">;</span>\\n\\n@<span class=\\\"token function\\\">Injectable</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">{</span>\\n  providedIn<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'root'</span><span class=\\\"token punctuation\\\">,</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span>\\n<span class=\\\"token keyword\\\">export</span> <span class=\\\"token keyword\\\">class</span> <span class=\\\"token class-name\\\">MessagingService</span> <span class=\\\"token punctuation\\\">{</span>\\n  messaging <span class=\\\"token operator\\\">=</span> firebase<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">messaging</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  currentMessage <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\">BehaviorSubject</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">null</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token keyword\\\">constructor</span><span class=\\\"token punctuation\\\">(</span>\\n    <span class=\\\"token keyword\\\">private</span> db<span class=\\\"token punctuation\\\">:</span> AngularFireDatabase<span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token keyword\\\">private</span> afAuth<span class=\\\"token punctuation\\\">:</span> AngularFireAuth\\n  <span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token comment\\\">// Add the public key generated from the console here.</span>\\n    <span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span>messaging<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">usePublicVapidKey</span><span class=\\\"token punctuation\\\">(</span>\\n      <span class=\\\"token string\\\">''</span> <span class=\\\"token comment\\\">// &lt;- ここに、上記で生成した鍵ペアを貼りつけてください</span>\\n    <span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n\\n  <span class=\\\"token function\\\">updateToken</span><span class=\\\"token punctuation\\\">(</span>token<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span>afAuth<span class=\\\"token punctuation\\\">.</span>authState<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">subscribe</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span>user<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token operator\\\">!</span>user<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n        <span class=\\\"token keyword\\\">return</span><span class=\\\"token punctuation\\\">;</span>\\n      <span class=\\\"token punctuation\\\">}</span>\\n\\n      <span class=\\\"token keyword\\\">const</span> data <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span> <span class=\\\"token punctuation\\\">[</span>user<span class=\\\"token punctuation\\\">.</span>uid<span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">:</span> token <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n      <span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span>db<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">object</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'fcmTokens/'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">update</span><span class=\\\"token punctuation\\\">(</span>data<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n\\n  <span class=\\\"token function\\\">getPermission</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span>messaging\\n      <span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">requestPermission</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span>\\n      <span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">then</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n        <span class=\\\"token builtin\\\">console</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">log</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'Notification permission granted.'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n        <span class=\\\"token keyword\\\">return</span> <span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span>messaging<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">getToken</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n      <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span>\\n      <span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">then</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span>token<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n        <span class=\\\"token builtin\\\">console</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">log</span><span class=\\\"token punctuation\\\">(</span>token<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n        <span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">updateToken</span><span class=\\\"token punctuation\\\">(</span>token<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n      <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span>\\n      <span class=\\\"token punctuation\\\">.</span><span class=\\\"token keyword\\\">catch</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span>err<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n        <span class=\\\"token builtin\\\">console</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">log</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'Unable to get permission to notify.'</span><span class=\\\"token punctuation\\\">,</span> err<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n      <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n\\n  <span class=\\\"token function\\\">receiveMessage</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span>messaging<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">onMessage</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span>payload<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token builtin\\\">console</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">log</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'Message received. '</span><span class=\\\"token punctuation\\\">,</span> payload<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n      <span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span>currentMessage<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">next</span><span class=\\\"token punctuation\\\">(</span>payload<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n</code></pre>\\n      </div>\\n<h4 id=\\\"appmoduletsを修正\\\">app.module.tsを修正</h4>\\n<div class=\\\"gatsby-code-title gatsby-remark-code-title\\\">src/app/app.module.ts</div>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-typescript\\\"><code class=\\\"language-typescript\\\"><span class=\\\"token comment\\\">// ... 省略 ...</span>\\n<span class=\\\"token keyword\\\">import</span> <span class=\\\"token punctuation\\\">{</span> MessagingService <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword\\\">from</span> <span class=\\\"token string\\\">'./service/messaging.service'</span><span class=\\\"token punctuation\\\">;</span>\\n\\n@<span class=\\\"token function\\\">NgModule</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token comment\\\">// ... 省略 ...</span>\\n  providers<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token punctuation\\\">[</span>\\n    MessagingService<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token comment\\\">// ← を追加</span>\\n  <span class=\\\"token punctuation\\\">]</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span>\\n<span class=\\\"token keyword\\\">export</span> <span class=\\\"token keyword\\\">class</span> <span class=\\\"token class-name\\\">AppModule</span> <span class=\\\"token punctuation\\\">{</span><span class=\\\"token punctuation\\\">}</span>\\n</code></pre>\\n      </div>\\n<h4 id=\\\"appcomponenttsを修正\\\">app.component.tsを修正</h4>\\n<div class=\\\"gatsby-code-title gatsby-remark-code-title\\\">src/app/app.component.ts</div>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-typescript\\\"><code class=\\\"language-typescript\\\"><span class=\\\"token comment\\\">// ... 省略 ...</span>\\n<span class=\\\"token keyword\\\">import</span> <span class=\\\"token punctuation\\\">{</span> MessagingService <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword\\\">from</span> <span class=\\\"token string\\\">'./service/messaging.service'</span><span class=\\\"token punctuation\\\">;</span>\\n\\n@<span class=\\\"token function\\\">Component</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">{</span>\\n  selector<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'app-root'</span><span class=\\\"token punctuation\\\">,</span>\\n  templateUrl<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'./app.component.html'</span><span class=\\\"token punctuation\\\">,</span>\\n  styleUrls<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token punctuation\\\">[</span><span class=\\\"token string\\\">'./app.component.scss'</span><span class=\\\"token punctuation\\\">]</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span>\\n<span class=\\\"token keyword\\\">export</span> <span class=\\\"token keyword\\\">class</span> <span class=\\\"token class-name\\\">AppComponent</span> <span class=\\\"token keyword\\\">implements</span> <span class=\\\"token class-name\\\">OnInit</span> <span class=\\\"token punctuation\\\">{</span>\\n  message<span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token keyword\\\">constructor</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">private</span> msgService<span class=\\\"token punctuation\\\">:</span> MessagingService<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span><span class=\\\"token punctuation\\\">}</span>\\n\\n  <span class=\\\"token function\\\">ngOnInit</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span>msgService<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">getPermission</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span>msgService<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">receiveMessage</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span>message <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span>msgService<span class=\\\"token punctuation\\\">.</span>currentMessage<span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n  <span class=\\\"token comment\\\">// ... 省略 ...</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n</code></pre>\\n      </div>\\n<p>これで、以下のようにアプリにアクセスすると、</p>\\n<p>「通知を許可しますか？」という確認アラートが表示されるようになります！🎉</p>\\n<img src=\\\"https://qiita-image-store.s3.amazonaws.com/0/128271/73bb1add-2101-7a4a-1baa-9a20059dc938.png\\\" width=\\\"30%\\\">\\n<p><br><br></p>\\n<p>引き続き、Firebase Functions側の実装については、以下の記事をご覧ください！\\n<a href=\\\"/angular-firebase-send-push-notifications-2\\\">👉 Angular + Firebase + PWAでPush通知機能を実装する（Firebase Functions側）</a></p>\",\"fields\":{\"slug\":\"/angular-firebase-send-push-notifications-1/\",\"prefix\":\"2018-12-22\"},\"frontmatter\":{\"title\":\"Angular + Firebase + PWAでPush通知機能を実装する（アプリ側）\",\"subTitle\":\"\",\"cover\":{\"childImageSharp\":{\"resize\":{\"src\":\"/static/angular-firebase-logo-4d677ee544f358ba6f204f21fee75be5-160fa.png\"}}}}},\"author\":{\"id\":\"/Users/jslee/Development/lighthouse-dev.github.io/content/parts/author.md absPath of file >>> MarkdownRemark\",\"html\":\"<p><strong>jslee</strong> <br>\\n福岡在住外国籍WEBエンジニア👋 <br>\\nPHPやVue.js、Angularなど書いてます！ 無類のラーメン好き🍜</p>\"},\"footnote\":{\"id\":\"/Users/jslee/Development/lighthouse-dev.github.io/content/parts/footnote.md absPath of file >>> MarkdownRemark\",\"html\":\"<ul>\\n<li><a href=\\\"../\\\">lighthouse.log</a></li>\\n</ul>\"},\"site\":{\"siteMetadata\":{\"facebook\":{\"appId\":\"\"}}}},\"pathContext\":{\"slug\":\"/angular-firebase-send-push-notifications-1/\"}}\n\n/***/ })\n\n});\n\n\n// WEBPACK FOOTER //\n// path---angular-firebase-send-push-notifications-1-cbdb37a8835ba949ecb5.js","module.exports = {\"data\":{\"post\":{\"id\":\"/Users/jslee/Development/lighthouse-dev.github.io/content/posts/2018-12-22--angular-firebase-send-push-notifications-1/index.md absPath of file >>> MarkdownRemark\",\"html\":\"<h1 id=\\\"はじめに\\\">はじめに</h1>\\n<p>こんにちは！</p>\\n<p><a href=\\\"https://qiita.com/advent-calendar/2017/fusic\\\">去年</a>に引き続き、今年も書きます。</p>\\n<p><a href=\\\"https://qiita.com/advent-calendar/2018/fusic\\\">Fusic Advent Calendar 2018</a> 19日目の記事です！</p>\\n<p>今回は、「Angular + Firebase + PWAでPush通知機能を実装」についてまとめてみました 👏</p>\\n<br>\\n<h1 id=\\\"やりたいこと\\\">やりたいこと</h1>\\n<p>PWAでPush機能実装したい！</p>\\n<p>※ PWAって何？的な説明は、以下を見てください</p>\\n<ul>\\n<li><a href=\\\"https://developers.google.com/web/fundamentals/codelabs/your-first-pwapp/?hl=ja\\\">https://developers.google.com/web/fundamentals/codelabs/your-first-pwapp/?hl=ja</a></li>\\n<li><a href=\\\"https://developers.google.com/web/progressive-web-apps/\\\">https://developers.google.com/web/progressive-web-apps/</a></li>\\n</ul>\\n<br>\\n<h1 id=\\\"開発環境\\\">開発環境</h1>\\n<ul>\\n<li>Angular 6</li>\\n<li>\\n<p>Firebase</p>\\n<ul>\\n<li>Realtime Database</li>\\n<li>Functions</li>\\n</ul>\\n</li>\\n</ul>\\n<br>\\n<h1 id=\\\"さっそく実装に入りましょう-🤩\\\">さっそく実装に入りましょう 🤩</h1>\\n<p>実装については、以下の流れで説明していきたいと思います！</p>\\n<ol>\\n<li>必要なモジュールなどをインストール</li>\\n<li>Push機能実装：アプリ側</li>\\n<li><a href=\\\"/angular-firebase-send-push-notifications-2\\\">Push機能実装：Firebase Functions側</a></li>\\n</ol>\\n<h2 id=\\\"必要なモジュールなどをインストール\\\">必要なモジュールなどをインストール</h2>\\n<p><strong>Firebase CLIをインストール</strong></p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-cmd\\\"><code class=\\\"language-cmd\\\">yarn global add firebase-tools@latest</code></pre>\\n      </div>\\n<p>※ Firebase CLIの詳細については、<a href=\\\"https://firebase.google.com/docs/cli/?hl=ja\\\">こちら</a>を見て下さい！</p>\\n<p><strong>Firebaseモジュールをインストール</strong></p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-cmd\\\"><code class=\\\"language-cmd\\\">yarn add firebase --save</code></pre>\\n      </div>\\n<p><a href=\\\"https://www.npmjs.com/package/firebase\\\">https://www.npmjs.com/package/firebase</a></p>\\n<br>\\n<h2 id=\\\"push機能実装：アプリ側\\\">Push機能実装：アプリ側</h2>\\n<h3 id=\\\"manifestjsonを修正\\\">manifest.jsonを修正</h3>\\n<p>ハードコード値 <code class=\\\"language-text\\\">gcm_sender_id</code> を指定するウェブアプリ マニフェストを追加する必要があります。</p>\\n<blockquote>\\n<p>「ブラウザ送信者 ID」と、Firebase プロジェクト設定に示されるプロジェクト固有の送信者 ID 値とを混同しないでください。\\nmanifest.json のブラウザ送信者 ID は固定値で、すべての FCM JavaScript クライアントで共通です。</p>\\n</blockquote>\\n<p> <code class=\\\"language-text\\\">gcm_sender_id</code>は、固定値ですので、変更しないでください！</p>\\n<div class=\\\"gatsby-code-title gatsby-remark-code-title\\\">src/manifest.json</div>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-json\\\"><code class=\\\"language-json\\\"><span class=\\\"token punctuation\\\">{</span>\\n  ... 省略 ...\\n  <span class=\\\"token property\\\">\\\"gcm_sender_id\\\"</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"103953800507\\\"</span> // ← gcm_sender_idを追加\\n  ... 省略 ...\\n<span class=\\\"token punctuation\\\">}</span>\\n</code></pre>\\n      </div>\\n<h3 id=\\\"メッセージサービスワーカーを作成\\\">メッセージサービスワーカーを作成</h3>\\n<p>Pushメッセージには、 <code class=\\\"language-text\\\">service worker</code> が必要になります。\\nまず、Firebaseで <code class=\\\"language-text\\\">messagingSenderId</code>をコピーしておきましょう。</p>\\n\\n  <a class=\\\"gatsby-resp-image-link\\\" href=\\\"/static/image-1-2942bf1f0d78ee14e610bf7e0b5d43b9-6eb54.png\\\" style=\\\"display: block\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">\\n  \\n  <span class=\\\"gatsby-resp-image-wrapper\\\" style=\\\"position: relative; display: block; margin-left: 0 !important; max-width: 800px; margin-left: auto; margin-right: auto;\\\">\\n    <span class=\\\"gatsby-resp-image-background-image\\\" style=\\\"padding-bottom: 74.63330457290768%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsSAAALEgHS3X78AAACo0lEQVQ4y5WTy24SURjHeQJ9AVcmWvsYLurGbWtStY0bbQXKDMMwUBtsNKm00tobt6YwMDPMDWa4VgreEo3v9fc7B0qLrQsXv3zn+j/f7QRuPRZwmwjMhUc8+k/m/mLxhYynK0ncWxAw+0TAA8ZChDMzH7kcE7Nje3/+khm+JkwIrIkSgkIMkajMEaQ4xJiCKCHFk5yonCCUaWIjK9J5fm98PxAUZITEEa/CIra2MzAtC5puoFRWUVZVGDUTbr0Ox53G830cZfPkBHt8nR5IMsEY95ALhkRkPh3g7KyHVqsFv9lEs9VEu91Gp9PhtDvjcbeLwWCA01KZIkpAVt4gRqIBJnQhuEIeftghD80GLMOEZRGOzanZ1sSatk1ROPA8D9lcnsL/hyALOZ3Zg1rRcFIoQjcMaDUD5ZoG3apBNw3YjoM6he+6LhqeT4KFmwXDZF+S4H5mF75eReWkCN+1SECHY5EgiVZqOs3tieB5x6eHR4LxxMZNglEcpnfwXdcwqFbw1dDwzTbw0zXh2SYVgrwjISbmkKdKsY7NvRxEVmUSZcW5nkMK2W54PE8WXTJsF4bboDUfVt2DS3s+VZflL621sHWQRzASnXTKpYfRUZX39g9x3v/Mq3zW68HpDqA1+9BbfXi9c3wZDjEcDtDt9/H71w+o1Sr1n8JzKLG2uerh6pqEjbfvkMsXeLKZPcgWkD7M4YjmBSrUx+Msty21jNpREYWdXcgkNFWUadEowjRm+YgRS2EJd5+tIijGCRl3lhaxHFqDmt7G8cNVlF6nkEqlqKnXr7fNxZh1PauaktxAhESXgwL3gFXzeTCMEJ3Zfb+F0/0TlCiHqcQ6JNqXr3oYGosGx96xb8R+gMi+Ff/fCY5Ec2aTtLapJLApjyIRx+f/AANl6wIhgsLkAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;\\\">\\n      <img class=\\\"gatsby-resp-image-image\\\" style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px transparent;\\\" alt=\\\"image 1\\\" title=\\\"\\\" src=\\\"/static/image-1-2942bf1f0d78ee14e610bf7e0b5d43b9-40b6f.png\\\" srcset=\\\"/static/image-1-2942bf1f0d78ee14e610bf7e0b5d43b9-9039c.png 200w,\\n/static/image-1-2942bf1f0d78ee14e610bf7e0b5d43b9-9db44.png 400w,\\n/static/image-1-2942bf1f0d78ee14e610bf7e0b5d43b9-40b6f.png 800w,\\n/static/image-1-2942bf1f0d78ee14e610bf7e0b5d43b9-6eb54.png 1159w\\\" sizes=\\\"(max-width: 800px) 100vw, 800px\\\">\\n    </span>\\n  </span>\\n  \\n  </a>\\n    \\n<p>次は、<code class=\\\"language-text\\\">src</code>ディレクトリの配下に <code class=\\\"language-text\\\">firebase-messaging-sw.js</code> を作成します。</p>\\n<p>そして、↑でコピーした<code class=\\\"language-text\\\">messagingSenderId</code> を、以下の <code class=\\\"language-text\\\">firebase.initializeApp()</code> に貼りつけます！</p>\\n<div class=\\\"gatsby-code-title gatsby-remark-code-title\\\">src/firebase-messaging-sw.js</div>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-typescript\\\"><code class=\\\"language-typescript\\\"><span class=\\\"token comment\\\">// Give the service worker access to Firebase Messaging.</span>\\n<span class=\\\"token comment\\\">// Note that you can only use Firebase Messaging here, other Firebase libraries</span>\\n<span class=\\\"token comment\\\">// are not available in the service worker.</span>\\n<span class=\\\"token function\\\">importScripts</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'https://www.gstatic.com/firebasejs/5.5.0/firebase-app.js'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token function\\\">importScripts</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'https://www.gstatic.com/firebasejs/5.5.0/firebase-messaging.js'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    \\n<span class=\\\"token comment\\\">// Initialize the Firebase app in the service worker by passing in the</span>\\n<span class=\\\"token comment\\\">// messagingSenderId.</span>\\nfirebase<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">initializeApp</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">{</span>\\n  messagingSenderId<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">''</span> <span class=\\\"token comment\\\">// ↑でコピーしたmessagingSenderIdを追加</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    \\n<span class=\\\"token comment\\\">// Retrieve an instance of Firebase Messaging so that it can handle background</span>\\n<span class=\\\"token comment\\\">// messages.</span>\\n<span class=\\\"token keyword\\\">const</span> messaging <span class=\\\"token operator\\\">=</span> firebase<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">messaging</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\nmessaging<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">setBackgroundMessageHandler</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">function</span><span class=\\\"token punctuation\\\">(</span>payload<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">const</span> notificationTitle <span class=\\\"token operator\\\">=</span> payload<span class=\\\"token punctuation\\\">.</span>notification<span class=\\\"token punctuation\\\">.</span>title<span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token keyword\\\">const</span> notificationOptions <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span>\\n    body<span class=\\\"token punctuation\\\">:</span> payload<span class=\\\"token punctuation\\\">.</span>notification<span class=\\\"token punctuation\\\">.</span>body<span class=\\\"token punctuation\\\">,</span>\\n    icon<span class=\\\"token punctuation\\\">:</span> payload<span class=\\\"token punctuation\\\">.</span>notification<span class=\\\"token punctuation\\\">.</span>icon\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token keyword\\\">return</span> self<span class=\\\"token punctuation\\\">.</span>registration<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">showNotification</span><span class=\\\"token punctuation\\\">(</span>notificationTitle<span class=\\\"token punctuation\\\">,</span> notificationOptions<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\nself<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">addEventListener</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'install'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token keyword\\\">function</span><span class=\\\"token punctuation\\\">(</span>event<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token builtin\\\">console</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">log</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'Service Worker installing.'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\nself<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">addEventListener</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'activate'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token keyword\\\">function</span><span class=\\\"token punctuation\\\">(</span>event<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token builtin\\\">console</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">log</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'Service Worker activating.'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre>\\n      </div>\\n<p>これで、ユーザーがアプリを閉じても、アプリが新しいメッセージを検知することができます！</p>\\n<h3 id=\\\"angularjsonを修正\\\">angular.jsonを修正</h3>\\n<p>angular.jsonに<code class=\\\"language-text\\\">manifest.json</code>, <code class=\\\"language-text\\\">firebase-messaging-sw.js</code> を追加</p>\\n<div class=\\\"gatsby-code-title gatsby-remark-code-title\\\">angular.json</div>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-json\\\"><code class=\\\"language-json\\\"><span class=\\\"token punctuation\\\">{</span>\\n  ... 省略 ...\\n  <span class=\\\"token property\\\">\\\"projects\\\"</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token property\\\">\\\"architect\\\"</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token property\\\">\\\"build\\\"</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token punctuation\\\">{</span>\\n        <span class=\\\"token property\\\">\\\"options\\\"</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token punctuation\\\">{</span>\\n          <span class=\\\"token property\\\">\\\"assets\\\"</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token punctuation\\\">[</span>\\n            <span class=\\\"token string\\\">\\\"src/favicon.ico\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n            <span class=\\\"token string\\\">\\\"src/assets\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n            <span class=\\\"token string\\\">\\\"src/manifest.json\\\"</span><span class=\\\"token punctuation\\\">,</span> // ←追加\\n            <span class=\\\"token string\\\">\\\"src/firebase-messaging-sw.js\\\"</span> // ←追加\\n          <span class=\\\"token punctuation\\\">]</span>\\n        <span class=\\\"token punctuation\\\">}</span>\\n      <span class=\\\"token punctuation\\\">}</span>\\n    <span class=\\\"token punctuation\\\">}</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n</code></pre>\\n      </div>\\n<h3 id=\\\"メッセージサービスを作成\\\">メッセージサービスを作成</h3>\\n<p>まずは、Firebaseの「鍵ペア」を生成する必要があります。</p>\\n<h4 id=\\\"firebaseで「鍵ペア」を生成\\\">Firebaseで「鍵ペア」を生成</h4>\\n<p>「プロジェクトの設定＞クラウドメッセージング」に入って、鍵ペアを生成してください。</p>\\n\\n  <a class=\\\"gatsby-resp-image-link\\\" href=\\\"/static/image-2-694ee39e36a729fdf3a2bde5a0a1977e-4dcde.png\\\" style=\\\"display: block\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">\\n  \\n  <span class=\\\"gatsby-resp-image-wrapper\\\" style=\\\"position: relative; display: block; margin-left: 0 !important; max-width: 800px; margin-left: auto; margin-right: auto;\\\">\\n    <span class=\\\"gatsby-resp-image-background-image\\\" style=\\\"padding-bottom: 78.64493996569468%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsSAAALEgHS3X78AAACOElEQVQ4y6WTy2oUQRSGWwTXgiufRHDvzncQ3JgYjBPxtowJiQYRFJlkQhgcTYaZ6a5rd1VfjKMufK/fc6ovdCYiiIuPv8/p7r9O1TkVXXt0imj9M6KHXxBtnOHKxul/Ed0czHH9icKNQYyra2S8flazxgs1rPV0lQc9ON4/0did5Ngbp3h5uMDmYYLHQ9JhjC16HnBMbB3Vujm8yNNRghfHCZ6N6veRMQpGS0IhtQaO4lQJZJTLU9Phrb4Q5/RtSTqeK7ydCBxNJTKjEc2FRsssUUiUhrYW2lgobSApZm3jFkkYY/BqLHH/Q4LnxwJT+j+KpUbLQijYNIX3HnmeB1VKQQgRlNFaB6M2XpY5fi0r/KgKJOTRGKrO0FAlKZk654JhlmUhZmX6i9WawxGZ88HjkmHYjqTzIEM2dfQj/+xanK/zK/BinSEbMfw8TyRmsehy/0pn2KmQdBYyNEM2Dairyxs80swF2pz/25YNHbqjEeERcKZWxR1u0RaCFmNW85e2zF16N4mxfRJj75PAzljgDc1YrOoxEaSCDQnZaAe9WzHUYQzuvY9xe2eOO/sL3Nqe4e5BDGlTmkOaO5rPsiyRM0WJgrpcFEwROv7HsXF0A869xVfX4FNYyvG2TJqFjn7PLb5luhulllBhv8Os3Ay+FVyRMvUN8bR6SVUUVFlJzXg9+4mD6RIFNYJzXCF/02uK7s2hpopsGHC+EbbZZlVVtNWKbpLHx8U5RguKqdqS8vyuoCNgj99yop6cK27sYQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;\\\">\\n      <img class=\\\"gatsby-resp-image-image\\\" style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px transparent;\\\" alt=\\\"image 2\\\" title=\\\"\\\" src=\\\"/static/image-2-694ee39e36a729fdf3a2bde5a0a1977e-40b6f.png\\\" srcset=\\\"/static/image-2-694ee39e36a729fdf3a2bde5a0a1977e-9039c.png 200w,\\n/static/image-2-694ee39e36a729fdf3a2bde5a0a1977e-9db44.png 400w,\\n/static/image-2-694ee39e36a729fdf3a2bde5a0a1977e-40b6f.png 800w,\\n/static/image-2-694ee39e36a729fdf3a2bde5a0a1977e-4dcde.png 1166w\\\" sizes=\\\"(max-width: 800px) 100vw, 800px\\\">\\n    </span>\\n  </span>\\n  \\n  </a>\\n    \\n<p>生成した鍵ペアをコピーしておいてください⭐️</p>\\n<h4 id=\\\"サービスを作成\\\">サービスを作成</h4>\\n<p>メッセージサービスは、Push通知メッセージを受け取るユーザーの許可を得る役割をします。</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-cmd\\\"><code class=\\\"language-cmd\\\">ng g service messaging</code></pre>\\n      </div>\\n<p>ざっくり以下のような構成になります！</p>\\n<h5 id=\\\"getpermission\\\"><code class=\\\"language-text\\\">getPermission()</code></h5>\\n<ul>\\n<li>ユーザーからPush通知を行う許可を取得</li>\\n</ul>\\n<h5 id=\\\"updatetoken\\\"><code class=\\\"language-text\\\">updateToken()</code></h5>\\n<ul>\\n<li>FirebaseにFCMトークンを保存</li>\\n<li>ユーザーにPush通知を送る度にこのトークンを参照するので、Firebaseに保存する</li>\\n</ul>\\n<h5 id=\\\"receivemessage\\\"><code class=\\\"language-text\\\">receiveMessage()</code></h5>\\n<ul>\\n<li>メッセージを受信</li>\\n</ul>\\n<div class=\\\"gatsby-code-title gatsby-remark-code-title\\\">src/app/service/messaging.service.ts</div>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-typescript\\\"><code class=\\\"language-typescript\\\"><span class=\\\"token keyword\\\">import</span> <span class=\\\"token punctuation\\\">{</span> Injectable <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword\\\">from</span> <span class=\\\"token string\\\">'@angular/core'</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">import</span> <span class=\\\"token punctuation\\\">{</span> AngularFireDatabase <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword\\\">from</span> <span class=\\\"token string\\\">'angularfire2/database'</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">import</span> <span class=\\\"token punctuation\\\">{</span> AngularFireAuth <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword\\\">from</span> <span class=\\\"token string\\\">'angularfire2/auth'</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">import</span> <span class=\\\"token punctuation\\\">{</span> BehaviorSubject <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword\\\">from</span> <span class=\\\"token string\\\">'rxjs'</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">import</span> <span class=\\\"token operator\\\">*</span> <span class=\\\"token keyword\\\">as</span> firebase <span class=\\\"token keyword\\\">from</span> <span class=\\\"token string\\\">'firebase'</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">import</span> <span class=\\\"token string\\\">'firebase/messaging'</span><span class=\\\"token punctuation\\\">;</span>\\n\\n@<span class=\\\"token function\\\">Injectable</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">{</span>\\n  providedIn<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'root'</span><span class=\\\"token punctuation\\\">,</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span>\\n<span class=\\\"token keyword\\\">export</span> <span class=\\\"token keyword\\\">class</span> <span class=\\\"token class-name\\\">MessagingService</span> <span class=\\\"token punctuation\\\">{</span>\\n  messaging <span class=\\\"token operator\\\">=</span> firebase<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">messaging</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  currentMessage <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\">BehaviorSubject</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">null</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token keyword\\\">constructor</span><span class=\\\"token punctuation\\\">(</span>\\n    <span class=\\\"token keyword\\\">private</span> db<span class=\\\"token punctuation\\\">:</span> AngularFireDatabase<span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token keyword\\\">private</span> afAuth<span class=\\\"token punctuation\\\">:</span> AngularFireAuth\\n  <span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token comment\\\">// Add the public key generated from the console here.</span>\\n    <span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span>messaging<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">usePublicVapidKey</span><span class=\\\"token punctuation\\\">(</span>\\n      <span class=\\\"token string\\\">''</span> <span class=\\\"token comment\\\">// &lt;- ここに、上記で生成した鍵ペアを貼りつけてください</span>\\n    <span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n\\n  <span class=\\\"token function\\\">updateToken</span><span class=\\\"token punctuation\\\">(</span>token<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span>afAuth<span class=\\\"token punctuation\\\">.</span>authState<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">subscribe</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span>user<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token operator\\\">!</span>user<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n        <span class=\\\"token keyword\\\">return</span><span class=\\\"token punctuation\\\">;</span>\\n      <span class=\\\"token punctuation\\\">}</span>\\n\\n      <span class=\\\"token keyword\\\">const</span> data <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span> <span class=\\\"token punctuation\\\">[</span>user<span class=\\\"token punctuation\\\">.</span>uid<span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">:</span> token <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n      <span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span>db<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">object</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'fcmTokens/'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">update</span><span class=\\\"token punctuation\\\">(</span>data<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n\\n  <span class=\\\"token function\\\">getPermission</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span>messaging\\n      <span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">requestPermission</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span>\\n      <span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">then</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n        <span class=\\\"token builtin\\\">console</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">log</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'Notification permission granted.'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n        <span class=\\\"token keyword\\\">return</span> <span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span>messaging<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">getToken</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n      <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span>\\n      <span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">then</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span>token<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n        <span class=\\\"token builtin\\\">console</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">log</span><span class=\\\"token punctuation\\\">(</span>token<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n        <span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">updateToken</span><span class=\\\"token punctuation\\\">(</span>token<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n      <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span>\\n      <span class=\\\"token punctuation\\\">.</span><span class=\\\"token keyword\\\">catch</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span>err<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n        <span class=\\\"token builtin\\\">console</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">log</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'Unable to get permission to notify.'</span><span class=\\\"token punctuation\\\">,</span> err<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n      <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n\\n  <span class=\\\"token function\\\">receiveMessage</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span>messaging<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">onMessage</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span>payload<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token builtin\\\">console</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">log</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'Message received. '</span><span class=\\\"token punctuation\\\">,</span> payload<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n      <span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span>currentMessage<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">next</span><span class=\\\"token punctuation\\\">(</span>payload<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n</code></pre>\\n      </div>\\n<h4 id=\\\"appmoduletsを修正\\\">app.module.tsを修正</h4>\\n<div class=\\\"gatsby-code-title gatsby-remark-code-title\\\">src/app/app.module.ts</div>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-typescript\\\"><code class=\\\"language-typescript\\\"><span class=\\\"token comment\\\">// ... 省略 ...</span>\\n<span class=\\\"token keyword\\\">import</span> <span class=\\\"token punctuation\\\">{</span> MessagingService <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword\\\">from</span> <span class=\\\"token string\\\">'./service/messaging.service'</span><span class=\\\"token punctuation\\\">;</span>\\n\\n@<span class=\\\"token function\\\">NgModule</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token comment\\\">// ... 省略 ...</span>\\n  providers<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token punctuation\\\">[</span>\\n    MessagingService<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token comment\\\">// ← を追加</span>\\n  <span class=\\\"token punctuation\\\">]</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span>\\n<span class=\\\"token keyword\\\">export</span> <span class=\\\"token keyword\\\">class</span> <span class=\\\"token class-name\\\">AppModule</span> <span class=\\\"token punctuation\\\">{</span><span class=\\\"token punctuation\\\">}</span>\\n</code></pre>\\n      </div>\\n<h4 id=\\\"appcomponenttsを修正\\\">app.component.tsを修正</h4>\\n<div class=\\\"gatsby-code-title gatsby-remark-code-title\\\">src/app/app.component.ts</div>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-typescript\\\"><code class=\\\"language-typescript\\\"><span class=\\\"token comment\\\">// ... 省略 ...</span>\\n<span class=\\\"token keyword\\\">import</span> <span class=\\\"token punctuation\\\">{</span> MessagingService <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword\\\">from</span> <span class=\\\"token string\\\">'./service/messaging.service'</span><span class=\\\"token punctuation\\\">;</span>\\n\\n@<span class=\\\"token function\\\">Component</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">{</span>\\n  selector<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'app-root'</span><span class=\\\"token punctuation\\\">,</span>\\n  templateUrl<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'./app.component.html'</span><span class=\\\"token punctuation\\\">,</span>\\n  styleUrls<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token punctuation\\\">[</span><span class=\\\"token string\\\">'./app.component.scss'</span><span class=\\\"token punctuation\\\">]</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span>\\n<span class=\\\"token keyword\\\">export</span> <span class=\\\"token keyword\\\">class</span> <span class=\\\"token class-name\\\">AppComponent</span> <span class=\\\"token keyword\\\">implements</span> <span class=\\\"token class-name\\\">OnInit</span> <span class=\\\"token punctuation\\\">{</span>\\n  message<span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token keyword\\\">constructor</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">private</span> msgService<span class=\\\"token punctuation\\\">:</span> MessagingService<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span><span class=\\\"token punctuation\\\">}</span>\\n\\n  <span class=\\\"token function\\\">ngOnInit</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span>msgService<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">getPermission</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span>msgService<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">receiveMessage</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span>message <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span>msgService<span class=\\\"token punctuation\\\">.</span>currentMessage<span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n  <span class=\\\"token comment\\\">// ... 省略 ...</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n</code></pre>\\n      </div>\\n<p>これで、以下のようにアプリにアクセスすると、</p>\\n<p>「通知を許可しますか？」という確認アラートが表示されるようになります！🎉</p>\\n<img src=\\\"https://qiita-image-store.s3.amazonaws.com/0/128271/73bb1add-2101-7a4a-1baa-9a20059dc938.png\\\" width=\\\"30%\\\">\\n<p><br><br></p>\\n<p>引き続き、Firebase Functions側の実装については、以下の記事をご覧ください！\\n<a href=\\\"/angular-firebase-send-push-notifications-2\\\">👉 Angular + Firebase + PWAでPush通知機能を実装する（Firebase Functions側）</a></p>\",\"fields\":{\"slug\":\"/angular-firebase-send-push-notifications-1/\",\"prefix\":\"2018-12-22\"},\"frontmatter\":{\"title\":\"Angular + Firebase + PWAでPush通知機能を実装する（アプリ側）\",\"subTitle\":\"\",\"cover\":{\"childImageSharp\":{\"resize\":{\"src\":\"/static/angular-firebase-logo-4d677ee544f358ba6f204f21fee75be5-160fa.png\"}}}}},\"author\":{\"id\":\"/Users/jslee/Development/lighthouse-dev.github.io/content/parts/author.md absPath of file >>> MarkdownRemark\",\"html\":\"<p><strong>jslee</strong> <br>\\n福岡在住外国籍WEBエンジニア👋 <br>\\nPHPやVue.js、Angularなど書いてます！ 無類のラーメン好き🍜</p>\"},\"footnote\":{\"id\":\"/Users/jslee/Development/lighthouse-dev.github.io/content/parts/footnote.md absPath of file >>> MarkdownRemark\",\"html\":\"<ul>\\n<li><a href=\\\"../\\\">lighthouse.log</a></li>\\n</ul>\"},\"site\":{\"siteMetadata\":{\"facebook\":{\"appId\":\"\"}}}},\"pathContext\":{\"slug\":\"/angular-firebase-send-push-notifications-1/\"}}\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/json-loader!./.cache/json/angular-firebase-send-push-notifications-1.json\n// module id = 877\n// module chunks = 196905431834707"],"sourceRoot":""}
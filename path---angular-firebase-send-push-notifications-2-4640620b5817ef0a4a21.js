webpackJsonp([0xdab12fab923e],{877:function(n,s){n.exports={data:{post:{id:"/Users/jslee/Development/lighthouse-dev.github.io/content/posts/2018-12-22--angular-firebase-send-push-notifications-2/index.md absPath of file >>> MarkdownRemark",html:'<!-- @import "[TOC]" {cmd="toc" depthFrom=1 depthTo=6 orderedList=false} -->\n<!-- code_chunk_output -->\n<ul>\n<li>\n<p><a href="#push-%E6%A9%9F%E8%83%BD%E5%AE%9F%E8%A3%85firebase-functions-%E5%81%B4">Push æ©Ÿèƒ½å®Ÿè£…ï¼šFirebase Functions å´</a></p>\n<ul>\n<li><a href="#firebase-%E3%81%AE-functions-%E3%82%92%E5%88%9D%E6%9C%9F%E5%8C%96%E3%81%97%E9%96%A2%E6%95%B0%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B">Firebase ã® functions ã‚’åˆæœŸåŒ–ã—ã€é–¢æ•°ã‚’ä½œæˆã™ã‚‹</a></li>\n<li><a href="#indexts-%E3%82%92%E4%BF%AE%E6%AD%A3">index.ts ã‚’ä¿®æ­£</a></li>\n</ul>\n</li>\n<li><a href="#%E3%81%BE%E3%81%A8%E3%82%81">ã¾ã¨ã‚</a></li>\n<li><a href="#%E3%81%8A%E3%81%BE%E3%81%91">ãŠã¾ã‘</a></li>\n<li><a href="#%E5%8F%82%E8%80%83-url">å‚è€ƒ URL</a></li>\n</ul>\n<!-- /code_chunk_output -->\n<h1>Push æ©Ÿèƒ½å®Ÿè£…ï¼šFirebase Functions å´</h1>\n<p><a href="/angular-firebase-send-push-notifications-1">Angular + Firebase + PWA ã§ Push é€šçŸ¥æ©Ÿèƒ½ã‚’å®Ÿè£…ã™ã‚‹ï¼ˆã‚¢ãƒ—ãƒªå´ï¼‰</a>\nã«å¼•ãç¶šãã€Firebase Functions å´ã®å®Ÿè£…ã§ã™ã€‚</p>\n<h2>Firebase ã® functions ã‚’åˆæœŸåŒ–ã—ã€é–¢æ•°ã‚’ä½œæˆã™ã‚‹</h2>\n<div class="gatsby-highlight">\n      <pre class="language-cmd"><code class="language-cmd">firebase init functions</code></pre>\n      </div>\n<p>â€» ä½œæˆã®è©³ç´°æ‰‹é †ã«ã¤ã„ã¦ã¯ã€<a href="https://firebase.google.com/docs/functions/get-started?hl=ja">ã“ã¡ã‚‰</a>ã‚’è¦‹ã¦ãã ã•ã„ï¼</p>\n<br>\n<p>åˆæœŸåŒ–ã™ã‚‹ã¨ã€ä»¥ä¸‹ã®æ§‹æˆã«ãªã‚Šã¾ã™ï¼</p>\n<div class="gatsby-highlight">\n      <pre class="language-json"><code class="language-json">myproject\n  +- .firebaserc    # Hidden file that helps you quickly switch between\n  |                 # projects with `firebase use`\n  |\n  +- firebase.json  # Describes properties for your project\n  |\n  +- functions/     # Directory containing all your functions code\n      |\n      +- package.json  # npm package file describing your Cloud Functions code.\n      |\n      +- tsconfig.json # Config file containing compiler options.\n      |\n      +- tslint.json   # Optional file containing rules for TypeScript linting.\n      |\n      +- src/     # Directory containing TypeScript source\n      |   |\n      |   +- index.ts     # main source file for your Cloud Functions code\n      |\n      +- lib/\n          |\n          +- index.js     # JavaScript output from TypeScript source.\n          |\n          +- index.js.map # Sourcemap file for TypeScript source.\n</code></pre>\n      </div>\n<p>ã“ã“ã‹ã‚‰ã¯ã€functions/src/index.ts ã‚’ä¿®æ­£ã—ã¦ã„ãã¾ã™ãƒ¼ï¼</p>\n<h2>index.ts ã‚’ä¿®æ­£</h2>\n<p>DB ã«æ›´æ–°ãŒã‚ã‚‹åº¦ã«ã€ãƒˆãƒªã‚¬ãƒ¼ã«ã‚ˆã£ã¦ <code class="language-text">onCreate()</code> ãŒå®Ÿè¡Œã•ã‚Œã¾ã™ã€‚</p>\n<p>ã¾ãŸã€DB ã«ä¿å­˜ã•ã‚Œã¦ã„ã‚‹ FCM ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—ã—ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ‡ãƒ¼ã‚¿ã‚’ç”¨ã„ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«é€ä¿¡ã™ã‚‹ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ãŒä½œã‚‰ã‚Œã¾ã™ã€‚</p>\n<div class="gatsby-code-title gatsby-remark-code-title">functions/src/index.ts</div>\n<div class="gatsby-highlight">\n      <pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> functions <span class="token keyword">from</span> <span class="token string">\'firebase-functions\'</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> admin <span class="token keyword">from</span> <span class="token string">\'firebase-admin\'</span><span class="token punctuation">;</span>\nadmin<span class="token punctuation">.</span><span class="token function">initializeApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">export</span> <span class="token keyword">const</span> fcmSend <span class="token operator">=</span> functions<span class="token punctuation">.</span>database\n  <span class="token punctuation">.</span><span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">\'\'</span><span class="token punctuation">)</span> <span class="token comment">// â†ã“ã“ã¯ã€å„è‡ªã®DBæ§‹é€ ã«åˆã‚ã›ã¦å®šç¾©ã—ã¦ãã ã•ã„ï¼ˆä¾‹ï¼š/article/{articleId}ï¼‰</span>\n  <span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token punctuation">(</span>snapshot<span class="token punctuation">,</span> context<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> articleInfo <span class="token operator">=</span> snapshot<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">const</span> payload <span class="token operator">=</span> <span class="token punctuation">{</span>\n      notification<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n        title<span class="token punctuation">:</span> <span class="token string">\'\'</span><span class="token punctuation">,</span> <span class="token comment">// Pushãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ã‚¿ã‚¤ãƒˆãƒ«</span>\n        body<span class="token punctuation">:</span> articleInfo<span class="token punctuation">.</span>title <span class="token operator">+</span> <span class="token string">\'ãŒç™»éŒ²ã•ã‚Œã¾ã—ãŸ ğŸ‰\'</span><span class="token punctuation">,</span> <span class="token comment">// Pushãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æœ¬æ–‡</span>\n        clickAction<span class="token punctuation">:</span> <span class="token string">\'\'</span><span class="token punctuation">,</span> <span class="token comment">// Pushé€šçŸ¥ã‚’ã‚¿ãƒƒãƒ—ã—ãŸæ™‚ã«ã€é£›ã°ã™URLã‚’æŒ‡å®š</span>\n        icon<span class="token punctuation">:</span> <span class="token string">\'\'</span><span class="token punctuation">,</span> <span class="token comment">// Pushé€šçŸ¥ã§ä½¿ã†ãƒ­ã‚´</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    admin\n      <span class="token punctuation">.</span><span class="token function">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n      <span class="token punctuation">.</span><span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">\'/fcmTokens/\'</span><span class="token punctuation">)</span>\n      <span class="token punctuation">.</span><span class="token function">once</span><span class="token punctuation">(</span><span class="token string">\'value\'</span><span class="token punctuation">)</span>\n      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n        <span class="token keyword">const</span> tokenList <span class="token operator">=</span> token<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">\'\'</span><span class="token punctuation">;</span>\n\n        Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>tokenList<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>tokenList<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n          admin\n            <span class="token punctuation">.</span><span class="token function">messaging</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n            <span class="token punctuation">.</span><span class="token function">sendToDevice</span><span class="token punctuation">(</span>tokenList<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span> payload<span class="token punctuation">)</span>\n            <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n              <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'Sent Successfully\'</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token punctuation">}</span><span class="token punctuation">)</span>\n            <span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n              <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span>\n      <span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n      </div>\n<p>ã“ã‚Œã§å®Ÿè£…å®Œäº†ã§ã™ï¼</p>\n<p>å®Ÿéš›ã«ã€ã“ã‚“ãªæ„Ÿã˜ã§ Push é€šçŸ¥ãŒé£›ã‚“ã§ãã¾ã™ã€‚</p>\n<img src="https://qiita-image-store.s3.amazonaws.com/0/128271/9a5062ac-19e2-53ed-f152-720c0ba59efe.png" width="30%">\n<p><br><br></p>\n<p>ä»Šå›ã¯ã€ç‰¹å®šã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€äººä¸€äººã« Push é€šçŸ¥ã‚’é€ä¿¡ã—ã¦ã„ã¾ã™ãŒã€</p>\n<p>è¤‡æ•°ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã™ã‚‹ã“ã¨ã‚‚ã§ãã‚‹ã‚‰ã—ã„ã®ã§ã€<a href="https://firebase.google.com/docs/cloud-messaging/js/send-multiple?hl=ja">ã“ã¡ã‚‰</a>ã‚‚ãœã²å‚è€ƒã«ã—ã¦ãã ã•ã„ï¼</p>\n<br>\n<h1>ã¾ã¨ã‚</h1>\n<p>Firebase æœ¬å½“æœ€é«˜ï¼ğŸ‘ğŸ‘ğŸ‘</p>\n<br>\n<h1>ãŠã¾ã‘</h1>\n<p>ä»Šå›ã®å®Ÿè£…ã‚’å«ã‚ãŸå€‹äººãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’é–‹ç™ºã—ã€é‹ç”¨ã—ã¦ã„ã¾ã™ã€‚</p>\n<p>ã“ã®ãƒ†ãƒ¼ãƒã§ã€<a href="https://frontend-conf.fukuoka.jp/">FRONTEND CONFERENCE FUKUOKA2018</a>ã§ãŠè©±ã•ã›ã¦ã„ãŸã ãã¾ã—ãŸã€‚</p>\n<p>ã‚¹ãƒ©ã‚¤ãƒ‰ãªã©ã‚’å…¬é–‹ã—ã¦ã¾ã™ã®ã§ã€èˆˆå‘³ã‚ã‚‹æ–¹ã¯æ˜¯éè¦‹ã¦ãã ã•ã„ï¼</p>\n<ul>\n<li>ãƒ†ãƒ¼ãƒï¼šAngular ã¨ Firebase ã§ä½œã£ãŸ PWA å¯¾å¿œã‚¢ãƒ—ãƒªã§å®¶åº­å†…ã®èª²é¡Œã‚’è§£æ±ºã—ãŸè©±ã€</li>\n<li>å…¬å¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ« ï¼š<a href="https://frontend-conf.fukuoka.jp/sessions#c-6">https://frontend-conf.fukuoka.jp/sessions#c-6</a></li>\n<li>ã‚¹ãƒ©ã‚¤ãƒ‰ï¼š<a href="https://slides.com/lighthouse-dev/fec_fukuoka/#/">https://slides.com/lighthouse-dev/fec_fukuoka/#/</a></li>\n</ul>\n<br>\n<h1>å‚è€ƒ URL</h1>\n<ul>\n<li><a href="https://angularfirebase.com/lessons/send-push-notifications-in-angular-with-firebase-cloud-messaging/#manifest-json">https://angularfirebase.com/lessons/send-push-notifications-in-angular-with-firebase-cloud-messaging/#manifest-json</a></li>\n<li><a href="https://firebase.google.com/docs/cloud-messaging/js/client?hl=ja">https://firebase.google.com/docs/cloud-messaging/js/client?hl=ja</a></li>\n<li><a href="https://firebase.google.com/docs/functions/get-started?hl=ja">https://firebase.google.com/docs/functions/get-started?hl=ja</a></li>\n<li><a href="https://firebase.google.com/docs/cloud-messaging/js/send-multiple?hl=ja">https://firebase.google.com/docs/cloud-messaging/js/send-multiple?hl=ja</a></li>\n</ul>',fields:{slug:"/angular-firebase-send-push-notifications-2/",prefix:"2018-12-22"},frontmatter:{title:"Angular + Firebase + PWAã§Pushé€šçŸ¥æ©Ÿèƒ½ã‚’å®Ÿè£…ã™ã‚‹ï¼ˆFirebase Functionså´ï¼‰",subTitle:"",cover:{childImageSharp:{resize:{src:"/static/angular-firebase-logo-4d677ee544f358ba6f204f21fee75be5-160fa.png"}}}}},author:{id:"/Users/jslee/Development/lighthouse-dev.github.io/content/parts/author.md absPath of file >>> MarkdownRemark",html:"<p><strong>jslee</strong> <br>\nç¦å²¡åœ¨ä½å¤–å›½ç±WEBã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ğŸ‘‹ <br>\nPHPã‚„Vue.jsã€Angularãªã©æ›¸ã„ã¦ã¾ã™ï¼ ç„¡é¡ã®ãƒ©ãƒ¼ãƒ¡ãƒ³å¥½ãğŸœ</p>"},footnote:{id:"/Users/jslee/Development/lighthouse-dev.github.io/content/parts/footnote.md absPath of file >>> MarkdownRemark",html:'<ul>\n<li><a href="../">lighthouse.log</a></li>\n</ul>'},site:{siteMetadata:{facebook:{appId:""}}}},pathContext:{slug:"/angular-firebase-send-push-notifications-2/"}}}});
//# sourceMappingURL=path---angular-firebase-send-push-notifications-2-4640620b5817ef0a4a21.js.map